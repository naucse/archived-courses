<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1>Knihovna Scikit-learn, přehled užitečných funkcí</h1>
<p>V předešlé hodině jsme se vyhýbali programování, jak jen se to dalo. Teď už si ale chceš také sama vše vyzkoušet.
Abys mohla úlohu rozmyšlenou v domácím úkolu naprogramovat, projdeme si nejdůležitější funkce, které budeš potřebovat.</p>
<p>Především budeme používat knihovnu <a href="https://scikit-learn.org">Sciki-learn</a> a samozrejmě také pandas. 
Potřebné věci projdeme na příkladu.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Načtení a příprava dat</h2>
<table> 
    <tr><td>

☑ výběr vstupních proměnných 


☑ chybějící hodnoty 

☑ kategorické hodnoty 

☑ přeškálování / normování hodnot  
 </td></tr>
</table><p>Na začátku vždy bude potřeba připravit data. Čištění dat a použití knihovny pandas už bys měla ovládat, 
zaměříme se jen na věci, které jsou specifické pro strojové učení.</p>
<p>Načíst data tedy umíš.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_platy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;static/salaries.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df_platy</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[2]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rank</th>
      <th>discipline</th>
      <th>yrs.since.phd</th>
      <th>yrs.service</th>
      <th>sex</th>
      <th>salary</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>61</th>
      <td>AssocProf</td>
      <td>B</td>
      <td>9</td>
      <td>8</td>
      <td>Male</td>
      <td>90304</td>
    </tr>
    <tr>
      <th>124</th>
      <td>AssocProf</td>
      <td>A</td>
      <td>25</td>
      <td>22</td>
      <td>Female</td>
      <td>62884</td>
    </tr>
    <tr>
      <th>151</th>
      <td>Prof</td>
      <td>B</td>
      <td>14</td>
      <td>12</td>
      <td>Male</td>
      <td>128148</td>
    </tr>
    <tr>
      <th>64</th>
      <td>AssocProf</td>
      <td>B</td>
      <td>11</td>
      <td>11</td>
      <td>Female</td>
      <td>103613</td>
    </tr>
    <tr>
      <th>129</th>
      <td>Prof</td>
      <td>A</td>
      <td>32</td>
      <td>30</td>
      <td>Male</td>
      <td>113278</td>
    </tr>
    <tr>
      <th>194</th>
      <td>AssocProf</td>
      <td>B</td>
      <td>19</td>
      <td>19</td>
      <td>Male</td>
      <td>86250</td>
    </tr>
    <tr>
      <th>78</th>
      <td>Prof</td>
      <td>B</td>
      <td>26</td>
      <td>19</td>
      <td>Male</td>
      <td>193000</td>
    </tr>
    <tr>
      <th>82</th>
      <td>Prof</td>
      <td>B</td>
      <td>17</td>
      <td>16</td>
      <td>Male</td>
      <td>135585</td>
    </tr>
    <tr>
      <th>114</th>
      <td>Prof</td>
      <td>A</td>
      <td>37</td>
      <td>37</td>
      <td>Male</td>
      <td>104279</td>
    </tr>
    <tr>
      <th>164</th>
      <td>AsstProf</td>
      <td>B</td>
      <td>3</td>
      <td>3</td>
      <td>Male</td>
      <td>89942</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Pro predikci použijeme jako příznaky <code>rank</code>, <code>discipline</code>, <code>yrs.since.phd</code>, <code>yrs.service</code> a <code>sex</code>, 
predikovat budeme hodnotu <code>salary</code>.</p>
<p>Pro učení potřebujeme všechny hondoty převést na čísla (<code>float</code>). Pokud by data obsahovala chybějící
hodnoty, nejjednodušší řešení je takové řádky zahodit. (Bonus: pokud bys měla data s větším množstvím
chybějících hodnot, podívej se na možnosti <a href="https://scikit-learn.org/stable/modules/classes.html#module-sklearn.impute">sklearn.impute</a>)</p>
<p>Důležité je vypořádat se s kategorickými hodnotami. Sloupce obsahující hodnoty typu Boolean nebo dvě hodnoty (např. muž/žena), lze snadno převést na hodnoty $[0,1]$.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_platy</span> <span class="o">=</span> <span class="n">df_platy</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s2">&quot;Male&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Female&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">df_platy</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[3]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rank</th>
      <th>discipline</th>
      <th>yrs.since.phd</th>
      <th>yrs.service</th>
      <th>sex</th>
      <th>salary</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>21</th>
      <td>Prof</td>
      <td>A</td>
      <td>31</td>
      <td>26</td>
      <td>0</td>
      <td>89565</td>
    </tr>
    <tr>
      <th>46</th>
      <td>Prof</td>
      <td>B</td>
      <td>25</td>
      <td>15</td>
      <td>0</td>
      <td>114778</td>
    </tr>
    <tr>
      <th>58</th>
      <td>AssocProf</td>
      <td>B</td>
      <td>9</td>
      <td>8</td>
      <td>0</td>
      <td>90215</td>
    </tr>
    <tr>
      <th>69</th>
      <td>Prof</td>
      <td>B</td>
      <td>17</td>
      <td>17</td>
      <td>1</td>
      <td>111512</td>
    </tr>
    <tr>
      <th>65</th>
      <td>AsstProf</td>
      <td>B</td>
      <td>4</td>
      <td>3</td>
      <td>0</td>
      <td>68404</td>
    </tr>
    <tr>
      <th>132</th>
      <td>Prof</td>
      <td>A</td>
      <td>56</td>
      <td>57</td>
      <td>0</td>
      <td>76840</td>
    </tr>
    <tr>
      <th>173</th>
      <td>Prof</td>
      <td>B</td>
      <td>37</td>
      <td>24</td>
      <td>0</td>
      <td>93164</td>
    </tr>
    <tr>
      <th>42</th>
      <td>AssocProf</td>
      <td>B</td>
      <td>23</td>
      <td>23</td>
      <td>0</td>
      <td>93418</td>
    </tr>
    <tr>
      <th>148</th>
      <td>Prof</td>
      <td>B</td>
      <td>27</td>
      <td>27</td>
      <td>0</td>
      <td>156938</td>
    </tr>
    <tr>
      <th>196</th>
      <td>AssocProf</td>
      <td>B</td>
      <td>9</td>
      <td>7</td>
      <td>0</td>
      <td>113600</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Pro kategorické proměnné s více možnostmi použijeme tzv. <em>onehot encoding</em>.</p>
<p>Např. sloupec <code>rank</code> obsahuje hodnoty <code>Prof</code>, <code>AsstProf</code> a <code>AssocProf</code>. K zakódování pomocí onehot encoding potřebujeme tři sloupce:</p>
<table>
<thead><tr>
<th>Původní hodnota</th>
<th>Kód </th>
</tr>
</thead>
<tbody>
<tr>
<td>Prof</td>
<td>1 0 0</td>
</tr>
<tr>
<td>AsstProf</td>
<td>0 1 0 </td>
</tr>
<tr>
<td>AssocProf</td>
<td>0 0 1  </td>
</tr>
</tbody>
</table>
<p>Knihovna Scikitlearn nabízí <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OneHotEncoder.html#sklearn.preprocessing.OneHotEncoder">sklearn.preprocessing.OneHotEncoder</a>, při práci s pandas však můžeme použít rovnou metodu <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.get_dummies.html">get_dummies</a>. (Pozn. <em>dummies</em> proto, že nám přibudou pomocné proměnné (sloupce), které se označují jako <em>dummy variables</em>.)</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_platy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df_platy</span><span class="p">)</span>
<span class="n">df_platy</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[4]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>yrs.since.phd</th>
      <th>yrs.service</th>
      <th>sex</th>
      <th>salary</th>
      <th>rank_AssocProf</th>
      <th>rank_AsstProf</th>
      <th>rank_Prof</th>
      <th>discipline_A</th>
      <th>discipline_B</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>19</td>
      <td>18</td>
      <td>0</td>
      <td>139750</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20</td>
      <td>16</td>
      <td>0</td>
      <td>173200</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3</td>
      <td>0</td>
      <td>79750</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>45</td>
      <td>39</td>
      <td>0</td>
      <td>115000</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>40</td>
      <td>41</td>
      <td>0</td>
      <td>141500</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>194</th>
      <td>19</td>
      <td>19</td>
      <td>0</td>
      <td>86250</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>195</th>
      <td>48</td>
      <td>53</td>
      <td>0</td>
      <td>90000</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>196</th>
      <td>9</td>
      <td>7</td>
      <td>0</td>
      <td>113600</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>197</th>
      <td>4</td>
      <td>4</td>
      <td>0</td>
      <td>92700</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>198</th>
      <td>4</td>
      <td>4</td>
      <td>0</td>
      <td>92000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>198 rows × 9 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Poslední krok předzpracování bývá přeškálování hodnot. Není to vždy nutné, ale některým modelům to může pomoci.
Využijeme <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html#sklearn.preprocessing.StandardScaler">StandardScaler</a>.</p>
<p>StandardScaler nám hodnoty přeškáluje, aby zhruba odpovídaly normálnímu rozdělení. Některé algoritmy to předpokládají. Může se pak např. stát, že příznak (sloupeček), která má výrazně větší rozptyl než ostatní, je brán jako významnější.</p>
<p>(Pozn.: vytvoříme zvlášť objekt na transformaci odezvy. Ten se nám bude později hodit, až budeme chtít z odezvy modelu vidět, jaká je opravdová hodnota platu. Tedy zkonvertovat predikované hodnoty zpět na hodnotu platu.).</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="k">import</span> <span class="n">StandardScaler</span> 

<span class="n">priznaky_ke_konverzi</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;yrs.since.phd&quot;</span><span class="p">,</span> <span class="s2">&quot;yrs.service&quot;</span><span class="p">]</span>
<span class="n">odezva</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;salary&quot;</span><span class="p">]</span>

<span class="n">transformace</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">df_platy</span><span class="p">[</span><span class="n">priznaky_ke_konverzi</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformace</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_platy</span><span class="p">[</span><span class="n">priznaky_ke_konverzi</span><span class="p">])</span>

<span class="n">transformace_odezva</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">df_platy</span><span class="p">[</span><span class="n">odezva</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformace_odezva</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_platy</span><span class="p">[</span><span class="n">odezva</span><span class="p">])</span>

<span class="n">df_platy</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[5]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>yrs.since.phd</th>
      <th>yrs.service</th>
      <th>sex</th>
      <th>salary</th>
      <th>rank_AssocProf</th>
      <th>rank_AsstProf</th>
      <th>rank_Prof</th>
      <th>discipline_A</th>
      <th>discipline_B</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>197</th>
      <td>-1.238251</td>
      <td>-0.940387</td>
      <td>0</td>
      <td>-0.644604</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>187</th>
      <td>-0.504442</td>
      <td>-0.436017</td>
      <td>1</td>
      <td>-0.257489</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>53</th>
      <td>-0.667511</td>
      <td>-1.024448</td>
      <td>1</td>
      <td>-1.275480</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>117</th>
      <td>0.881641</td>
      <td>1.161154</td>
      <td>0</td>
      <td>1.310241</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>97</th>
      <td>-0.178305</td>
      <td>-0.267893</td>
      <td>0</td>
      <td>-0.542623</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>168</th>
      <td>-0.096771</td>
      <td>0.320538</td>
      <td>0</td>
      <td>0.685391</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>43</th>
      <td>1.696985</td>
      <td>0.993031</td>
      <td>0</td>
      <td>-0.343355</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>115</th>
      <td>-0.585976</td>
      <td>-1.276633</td>
      <td>1</td>
      <td>-0.213698</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>190</th>
      <td>0.473970</td>
      <td>0.320538</td>
      <td>0</td>
      <td>1.494164</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>34</th>
      <td>-1.238251</td>
      <td>-1.108510</td>
      <td>0</td>
      <td>-1.081642</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Vytvoření trénovací a testovací množiny</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>V teorii strojového učení se vstupy modelu (příznaky, vstupní proměnné) typicky označují písmenem <code>X</code> a výstupy písmenem <code>y</code>. Řada programátorů toto používá i k označování proměnných v kódu. 
<code>X</code> představuje <em>matici</em> (neboli tabulku), kde každý řádek odpovídá jednomu datovému vzorku a každý sloupec jednomu příznaku (vstupní proměnné). <code>y</code> je vektor, neboli jeden sloupec s odezvou.</p>
<p>Na vyzobnutí odezvy se výborně hodí metoda <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pop.html">pop</a>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">df_platy</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;salary&quot;</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_platy</span> 

<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Index([&#39;yrs.since.phd&#39;, &#39;yrs.service&#39;, &#39;sex&#39;, &#39;rank_AssocProf&#39;,
       &#39;rank_AsstProf&#39;, &#39;rank_Prof&#39;, &#39;discipline_A&#39;, &#39;discipline_B&#39;],
      dtype=&#39;object&#39;)
salary
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Zbývá data rozdělit na trénovací a testovací. K tomu slouží metoda <a href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html?highlight=train%20test%20split#sklearn.model_selection.train_test_split">train_test_split</a>. 
Data nám rozdělí náhodně na trénovací a testovací sadu. Velikost testovací množiny můžeme specifikovat parametrem <code>test_size</code>, jeho defaultní hodnota je <code>0.25</code>, t. j. 25%.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">train_test_split</span> 

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Modely</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Můžeme přejít k samotnému učení. Vybereme si model. Přehled modelů najdeš v sekci <a href="https://scikit-learn.org/stable/supervised_learning.html#supervised-learning">Supervised learnig</a>.</p>
<p>Na regresi můžeš použít:</p>
<ul>
<li><p><a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html">LinearRegression</a></p>
</li>
<li><p><a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.Lasso.html#sklearn.linear_model.Lasso">Lasso</a></p>
<ul>
<li>hyperparametry: <ul>
<li>alpha, float, default=1.0 </li>
</ul>
</li>
</ul>
</li>
<li><p><a href="https://scikit-learn.org/stable/modules/generated/sklearn.svm.SVR.html#sklearn.svm.SVR">SVR</a></p>
<ul>
<li>hyperparametry:<ul>
<li>kernel, default rbf, one of ‘linear’, ‘poly’, ‘rbf’, ‘sigmoid’</li>
<li>C, float, optional (default=1.0)</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Na klasifikační úlohy (ke kterým se dostaneme v příští hodině) využiješ:</p>
<ul>
<li><p><a href="https://scikit-learn.org/stable/modules/generated/sklearn.tree.DecisionTreeClassifier.html#sklearn.tree.DecisionTreeClassifier">DecisionTreeClassifier</a></p>
</li>
<li><p><a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html#sklearn.ensemble.RandomForestClassifier">RandomForestClassifier</a></p>
<ul>
<li>hyperparametry:<ul>
<li>n_estimators, integer, optional (default=100)</li>
</ul>
</li>
</ul>
</li>
<li><p><a href="https://scikit-learn.org/stable/modules/generated/sklearn.svm.SVC.html#sklearn.svm.SVC">SVC</a></p>
<ul>
<li>hyperparametry:<ul>
<li>C, float, optional (default=1.0)</li>
<li>kernelstring, optional (default=’rbf’)</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Vytvoříme instanci vybraného modelu (jde nám teď jen o způsob použití knihovny, vezmeme nejjednodušší lineární regresi):</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">LinearRegression</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Trénování</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Model natrénujeme na trénovací množině:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[9]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>LinearRegression(copy_X=True, fit_intercept=True, n_jobs=None, normalize=False)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Predikce</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Natrénovaný model typicky chceme použít k ohodnocení nějakých nových datových vzorků, k tomu máme metodu <code>predict</code>. Zavolejme ji jak na trénovací, tak na testovací data.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_predikce</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">test_predikce</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Pozor, k učení jsme použili transformované hodnoty odezvy. Zajímají-li nás skutečné hodnoty platů, 
musíme i predikované hodnoty transformovat zpět.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># vypišme prvních deset tetovacích vzorků a jejich predikce</span>
<span class="n">odezva</span> <span class="o">=</span> <span class="n">transformace_odezva</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">test_predikce</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;odezva modelu    predicke platu     &quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{test_predikce[i]:&gt;10.2f}</span><span class="s2">         </span><span class="si">{odezva[i]:&gt;10.2f}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>odezva modelu    predicke platu     
      0.78          133224.89
      0.79          133551.89
      0.78          133463.79
     -0.91           85069.13
     -0.92           84715.12
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Evaluace modelu</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Můžeme využít funkci <code>score</code>, která nám vrátí hodnotu $R^2$ metriky:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R2 na trénovací množině: &quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R2 na testovací množině: &quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>R2 na trénovací množině:  0.5061452088432405
R2 na testovací množině:  0.5972945031380011
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Funkce pro všechny možné metriky najdeš v <a href="https://scikit-learn.org/stable/modules/classes.html?highlight=sklearn%20metrics#module-sklearn.metrics">sklearn.metrics</a>.
                                                            (nyní nás zajímají <a href="https://scikit-learn.org/stable/modules/classes.html?highlight=sklearn%20metrics#module-sklearn.metrics">regresní metriky</a>)</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="k">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>

<span class="n">MAE_train</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">train_predikce</span><span class="p">)</span>
<span class="n">MAE_test</span>  <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_predikce</span><span class="p">)</span>
<span class="n">MSE_train</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">train_predikce</span><span class="p">)</span> 
<span class="n">MSE_test</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_predikce</span><span class="p">)</span>
<span class="n">R2_train</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">train_predikce</span><span class="p">)</span>
<span class="n">R2_test</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_predikce</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trénovací data  Testovací data&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;MSE </span><span class="si">{MSE_train:&gt;10.3f}</span><span class="s2"> </span><span class="si">{MSE_test:&gt;10.3f}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;MAE </span><span class="si">{MAE_train:&gt;10.3f}</span><span class="s2"> </span><span class="si">{MAE_test:&gt;10.3f}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;R2  </span><span class="si">{R2_train:&gt;10.3f}</span><span class="s2"> </span><span class="si">{R2_test:&gt;10.3f}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Trénovací data  Testovací data
MSE      0.539      0.312
MAE      0.525      0.417
R2       0.506      0.597
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Uložení modelu</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Někdy si potřebujeme naučený model uchovat na další použití. Model lze uložit do souboru a zase načíst pomocí <code>pickle</code>.
Kujme pikle:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span> 

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;model.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">soubor</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">soubor</span><span class="p">)</span>


<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;model.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">soubor</span><span class="p">:</span>
    <span class="n">staronovy_model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">soubor</span><span class="p">)</span>

<span class="n">staronovy_model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[14]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>0.5972945031380011</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Pozn.: Bohužel mám poměrně bohaté špatné zkušenosti z načítáním modelů uložených před delším časem
(bývá problém načíst model uložený ve starší verzi Scikit-learn ve verzi novější).</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3>Bonusy:</h3>
<ul>
<li><p>volba vhodného modelu a jeho hyper-parametrů se skrývá pod klíčovým slovem <strong>model selection</strong>. Knihovna Scikit-learn obsahuje různé pomůcky k ulehčení toho výběru. Přesahuje to ale rámec tohoto kurzu, narazíš-li na to toho téma při samostudiu, pročti si <a href="https://scikit-learn.org/stable/modules/classes.html?highlight=model%20selection#module-sklearn.model_selection">sklear.model_selection</a>.</p>
</li>
<li><p>v příkladu výše jsme použili různé transformace nad daty a pak teprve tvorbu modelu. Až budeš v těchto věcech zběhlejší, bude se ti hodit propojit tyto věci dohromady. K tomu slouží tzv. <a href="https://scikit-learn.org/stable/modules/classes.html?highlight=pipeline#module-sklearn.pipeline">pipeline</a>.</p>
</li>
</ul>
</div>
</div>
</div>
 

