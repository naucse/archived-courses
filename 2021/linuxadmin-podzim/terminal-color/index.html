<div class="admonition warning"><p>Tohle jsou jen poznámky, ne materiály k samostudiu.</p>
</div><h1>Barvičky v terminálu</h1>
<p>Když napíšeš <code>ls</code>, vypíše se barevný výstup. Jak to dělá? A hlavně, jak si to uděláš ty?</p>
<p>Krátká odpověď je, že použiješ knihovnu, například Pythonní <a href="https://click.palletsprojects.com/en/8.0.x/api/#click.style">Click</a>, což je knihovna na uživatelská textová rozhraní.
Taková knihovna se postará o veškerou správu: bude fungovat na různých terminálech, poradí si i se změnou velikostí okna terminálu a vyřeší spoustu dalších problémů.
Pokud budeš chtít obarvovat textový výstup, je to nejlepší cesta, jak dosáhnout cíle.</p>
<p>Je ale dobré vědět, na čem ty knihovny staví a jak to funguje na pozadí.
Začneme nahlédnutím do prehistorie :)</p>
<p>Původní terminály byly připojené k tiskárnám. 
Po zadání příkazu do terminálu se požadovaný výstup vytiskl na papír.
Neexistovala klávesa <kbd>Backspace</kbd> ani <kbd>ESC</kbd>, protože když jsi udělala překlep, už byl dávno vytisknutý na papíře. 
Mohla jsi příkaz maximálně zrušit a napsat nový.
Postupem času terminál získal nové funkce a začal ukazovat vepsaný text na obrazovce. 
U těch nových, grafických terminálů už by šlo opravit překlep. 
Jenže s touhle variantou se původně nepočítalo, a tak se řešilo, jak napsat na klávesnici <kbd>ESC</kbd>. 
To řešení bylo, že když budeš chtít smazat písmeno, pošle se speciální řídící znak, který znamená mazání.
Tak jako když zmáčkneš <kbd>Enter</kbd>, je to speciální znak <code>\n</code>, který přehodí kurzor na nový řádek, vznikl speciální znak, který posune kurzor o jedno místo zpátky a případně smaže poslední znak.</p>
<p>Když se podíváš do tabulky ASCII (<code>man ascii</code>), zjistíš, že ta má na začátku spoustu řídících znaků. 
Prvních 31 znaků na začátku jsou speciální znaky a mají různé významy jako začátek textu, začátek hlavičky, protože ASCII tabulka vychází z telegrafů a jiných forem komunikace ještě před internetem.</p>
<p>Dnes se jich používá jen pár: nový řádek, tabulátor a pár dalších.</p>
<p>Podívejme se ale na ten jeden konkrétní znak, 27 - ESC.
To znamená útěk z toho módu, když se mají vykreslit písmenka na obrazovku, a informaci, že se bude dít něco navíc. 
ESC uvozuje sekvenci znaku, která říká, co se má stát, např. <em>nastav barvu na červenou</em>.
Znak s číslem 27 nejspíš na své klávesnici nenajdeš, a proto je čas na ukázku v Pythonu. 
Hexadecimálně 27 je 1B.</p>
<p>Vytvoř si soubor <code>barvicky.py</code> s obsahem níže:</p>
<div class="highlight"><pre><span></span><span class="c1"># barvicky.py</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x1B</span><span class="s1">[1;31m slovo&#39;</span><span class="p">)</span>
</pre></div><p>Když ho spustíš, výpis v terminálu bude červený.</p>
<div class="highlight"><pre><code>       +--- tzv. kontrolní sekvence, která nastavuje barvu
       |
    ------
\x1B[1;31m
----
  |
  +--- je jediný znak, a to ASCII ESC</code></pre></div><p>Kdy to přestane psát červeně? 
Až zavřeš terminál, nebo až napíšeš reset sekvenci.</p>
<p>Reset vypadá takto:</p>
<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x1B</span><span class="s1">[1;31m slovo   </span><span class="se">\x1B</span><span class="s1">[0m&#39;</span><span class="p">)</span>
</pre></div><p>1 znamená, že nastavuješ barvu, 31 je číslo konkrétní barvy.
Můžeš si udělat duhu v terminálu - vyzkoušej si skript:</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\x1B</span><span class="s1">[1;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">m slovo   </span><span class="se">\x1B</span><span class="s1">[0m&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\x1B</span><span class="s1">[1;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">m slovo   </span><span class="se">\x1B</span><span class="s1">[0m&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\x1B</span><span class="s1">[38;5;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">mM</span><span class="se">\x1B</span><span class="s1">[0m&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\x1B</span><span class="s1">[48;5;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">mM</span><span class="se">\x1B</span><span class="s1">[0m&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div><p>S těmito sekvencemi bývá problém, protože existuje různé terminály a jejich dodavatelé si barvičky implementovali po svém. 
To se sice standardizovalo do tak zvaných ANSI sekvencí, kterých ukázku vidíš ve skriptu výše, ale i tak nejlepší varianta je použít nějakou knihovnu jako již zmíněný Click.</p>
<p>Existují další řídící sekvence, které umí pohybovat kurzorem.
Jedna základní je <code>\r</code>, která posune kurzor na začátek řádku.
Vykoušej si cyklus v příkladu níže.</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div><p>Takto se například dají vykreslovat progress bary.
Má to ale i svá úskalí – například změna velikosti terminálu nemusí dopadnout dobře.
Pokud budeš mít za úkol napsát progress bar, určitě si na to nainstaluj knihovnu, která to správně vyřeší za tebe.</p>
<p>Další sekvence umí smazat obrazovku, pohybovat kurzorem a podobně.</p>
<p>Právě na tomto principu fungují terminálové editory.
Kdybys přesvědčila <code>nano</code>, že to na co je napojený je terminál (což bohužel není snadné),
mohla bys teoreticky udělat něco jako</p>
<div class="highlight"><pre><code>$ nano &gt; /tmp/nano-vystup</code></pre></div><p>A výsledek si zobrazit třeba přes:</p>
<div class="highlight"><pre><code>less /tmp/nano-vystup</code></pre></div><p>Zkus si to s příkazem <code>sl</code>, který je potřeba doinstalovat:</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span>sudo dnf install sl
<span class="gp">$ </span>sl
<span class="gp">$ </span>sl &gt; /tmp/sl
<span class="gp">$ </span>cat /tmp/sl
<span class="gp">$ </span>cat -t /tmp/sl   <span class="c1"># `cat -t` vypíše znak &quot;escape&quot; jako `^[`</span>
</pre></div>