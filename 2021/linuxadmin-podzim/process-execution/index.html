<h1>Spouštění procesů</h1>
<p>Pojďme se podívat na to, co přesně Bash dělá, když spustí program.</p>
<p>Příkaz <code>ps</code> bez argumentů vypíše jen ty procesy, které „patří“ k aktuálnímu
terminálu:</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span>ps
<span class="go">    PID TTY          TIME CMD</span>
<span class="go">   2328 pts/0    00:00:00 bash</span>
<span class="go">  14509 pts/0    00:00:00 ps</span>
</pre></div><p>Vidíš, že běží dva programy: jak <code>bash</code> tak <code>ps</code>.</p>
<p>Co když přesměruješ data z jednoho příkazu do druhého?
Ve výstupu <code>ps</code> uvidíš všechny spuštěné procesy:</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span>ps <span class="p">|</span> cat
<span class="go">    PID TTY          TIME CMD</span>
<span class="go">   2328 pts/0    00:00:00 bash</span>
<span class="go">  14661 pts/0    00:00:00 ps</span>
<span class="go">  14662 pts/0    00:00:00 cat</span>
</pre></div><div class="highlight"><pre><span></span><span class="gp">$ </span>ps <span class="p">|</span> cat <span class="p">|</span> sort
<span class="go">    PID TTY          TIME CMD</span>
<span class="go">  14679 pts/0    00:00:00 ps</span>
<span class="go">  14680 pts/0    00:00:00 cat</span>
<span class="go">  14681 pts/0    00:00:00 sort</span>
<span class="go">   2328 pts/0    00:00:00 bash</span>
</pre></div><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">echo</span> <span class="p">|</span> ps
<span class="go">    PID TTY          TIME CMD</span>
<span class="go">   2328 pts/0    00:00:00 bash</span>
<span class="go">  14689 pts/0    00:00:00 ps</span>
</pre></div><p>Všimni si, že v posledním příkladu chybí <code>echo</code>.
Proč? I k tomu se dnes dostaneme.</p>
<h2>Nastavení, spuštění a čekání</h2>
<p>Když Bash spouští program, udělá tři věci:</p>
<ul>
<li>Nastaví prostředí – přesměrovaný vstup/výstup, proměnné prostředí apod.;</li>
<li>program spustí;</li>
<li>čeká, až se program ukončí.</li>
</ul>
<p>Pokud Bash spouští několik programů najednou, udělá obecně každý z těchto
kroků pro všechny spouštěné programy najednou:
napřed všem programům nastaví prostředí, potom teprve všechny spustí,
a pak na všechny počká.</p>
<p>Příklady:</p>
<h3><code>ps</code></h3>
<ul>
<li>Prostředí je nastavené – std. vstup i výstup jdou na stejné místo jako
u Bashe.</li>
<li>Spustí se program <code>ps</code>.</li>
<li>Čeká se, než se <code>ps</code> ukončí.
(Program <code>ps</code> mezitím něco vypíše na std. výstup.)</li>
</ul>
<p>Po ukončení Bash vypíše výzvu a čeká na další příkaz.</p>
<p><span class="figure"><a href="naucse:static?filename=ps.svg"><img src="naucse:static?filename=ps.svg" alt="Diagram spouštění `ps`"></a></span></p>
<h3><code>ps | cat</code></h3>
<ul>
<li>Bash vytvoří novou rouru. Std. výstup z <code>ps</code> a std. vstup pro <code>cat</code>
přesměruje na tuto rouru.
(Zbylé – std. chyby, vstup pro <code>ps</code> i výstup z <code>cat</code> – nechá jako u Bashe.)</li>
<li>Spustí programy <code>ps</code> i <code>cat</code>.</li>
<li><p>Čeká, než se <code>ps</code> i <code>cat</code> ukončí.
(Programy mezitím spolu komunikují nebo píší na std. výstup.)</p>
<p><span class="figure"><a href="naucse:static?filename=ps-cat.svg"><img src="naucse:static?filename=ps-cat.svg" alt="Diagram spouštění `ps | cat`"></a></span></p>
</li>
</ul>
<h3><code>ps | cat | sort</code></h3>
<p>Příkazů propojených rourami může být více;
Bash skládá za sebe stejným spůsobem.</p>
<p><span class="figure"><a href="naucse:static?filename=ps-cat-sort.svg"><img src="naucse:static?filename=ps-cat-sort.svg" alt="Diagram spouštění `ps | cat | sort`"></a></span></p>
<h3><code>echo | ps</code></h3>
<p>Z pohledu spouštění je <code>echo | ps</code> úplně stejné jako <code>ps | cat</code>.
Příkaz <code>echo</code> se ale ukončí hned poté co vypíše svůj řádek, což je většinou
velice rychlé – zvládne to ještě dřív než se <code>ps</code> stihne zeptat systému na
běžící programy.
Proto <code>echo</code> většinou není ve výstupu vidět.:</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">echo</span> <span class="p">|</span> ps
<span class="go">    PID TTY          TIME CMD</span>
<span class="go">   2328 pts/0    00:00:00 bash</span>
<span class="go">  14689 pts/0    00:00:00 ps</span>
</pre></div><p><span class="figure"><a href="naucse:static?filename=echo-ps.svg"><img src="naucse:static?filename=echo-ps.svg" alt="Diagram spouštění `echo | ps`"></a></span></p>
<h2>Rolovátko</h2>
<p>Víš, proč se třeba <code>man</code> nebo <code>git diff</code> chovají a ovládají stejně jako <code>less</code>?
Proto, že samy spustí <code>less</code> a pošlou do něho rourou text,
který chtějí zobrazit.</p>
<p><span class="figure"><a href="naucse:static?filename=man-less.svg"><img src="naucse:static?filename=man-less.svg" alt="Diagram spouštění `less` z `man`"></a></span></p>
<p>Podobné programy většinou respektují proměnnou <code>PAGER</code>,
kterou můžeš vybrat program, který se použije místo <code>less</code>.
Zkus si <code>more</code>, starší verzi <code>less</code> která umí <kbd>Enter</kbd>,
<kbd>Mezerník</kbd> a <kbd>q</kbd>, ale neumí se vracet (<kbd>↑</kbd>):</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nv">PAGER</span><span class="o">=</span>more man bash
</pre></div><p>Nebo rolování vypni úplně pomocí <code>cat</code>:</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nv">PAGER</span><span class="o">=</span>cat man bash
</pre></div><p>Nebo jakýkoli jiný filtr – nikdo ti nezakazuje zadávat nesmysly:</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nv">PAGER</span><span class="o">=</span>wc   man bash
<span class="gp">$ </span><span class="nv">PAGER</span><span class="o">=</span>tac  man bash
<span class="gp">$ </span><span class="nv">PAGER</span><span class="o">=</span>rev  man bash
</pre></div>