<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1>Databáze</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Obsah:</p>
<ul>
<li>Úvod do databází</li>
<li>Úvod do relačních databází</li>
<li>Úvod do SQL + Python a Pandas</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Úvod do databází</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Doteď jste na kurzu zřejmě pracovali se <strong>soubory</strong> - odněkud soubor stáhli na svůj počítač, a tam ho zpracovali, a pak třeba zase výsledek někam nahráli. Tento postup ale nestačí, pokud s těmito daty potřebuje pracovat více lidí (nebo strojů) najednou a zároveň je i aktualizovat. To se řeší tak, že spustíte <strong>databázový systém</strong> (DBMS, <a href="https://cs.wikipedia.org/wiki/Syst%C3%A9m_%C5%99%C3%ADzen%C3%AD_b%C3%A1ze_dat">SŘBD</a>), ten ta data u sebe spravuje (soubory na disku obsahující specializované datové struktury) a vy se na tento systém připojujete přes počítačovou síť. Nebo třeba používáte webovou aplikaci a ta je na tento databázový systém (databázi) připojena.</p>
<p>Např. e-shop bude pracovat s databází, ve které jsou uloženy informace o prodávaném zboží, rozdělení zboží do kategorií, objednávky, reklamace, registrovaní uživatelé... Takovou databázi můžeme označit za "transakční".</p>
<p>Vy jako datoví analytici, inženýři apod. se pravděpodobně budete chtít do takovéto databáze připojit a stáhnout si z ní část dat pro svou další práci. Nebo dokonce může být vaším úkolem vytvořit novou "analytickou" databázi, která obsahuje data v jiné podobě, např. prodávané zboží bez popisků, bez fotografií, ale zato se statistikami návštěvnosti a prodejnosti.</p>
<p>V těchto materiálech budeme pracovat s databází <a href="https://www.sqlite.org/">SQLite</a>. Ta je poněkud specifická tím, že je uložena v jednom souboru (s příponou <code>.sqlite</code> nebo <code>.db</code>), není to tedy samostatně běžící server, ke kterému byste se připojovali, jak je tomu u většiny databází. O to snadněji se ale s SQLite pracuje. I SQLite umožňuje pracovat s jednou databází (jedním souborem) z několika programů zároveň, narozdíl od např. CSV nebo XLS sobourů.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Vlastnosti databází</h2>
<p>Od databáze (resp. databázového systému) očekáváme několik vlastností:</p>
<ul>
<li>Že bude uchovávat data :) Ne, vážně - data musí zůstat beze ztráty uložena i v případě výpadku napájení, když dojde místo na disku... Že existují nástroje pro zálohování a obnovu databáze.</li>
<li>Práce s daty "z různých úhlů". Např. v e-shopu chceme jednou vypsat zboží podle kategorie, jindy podle stavu skladových zásob, jindy na základě full-textového vyhledávání..</li>
<li>Podpora uživatelů, rolí, oprávnění a kontroly přístupu k datům.</li>
<li>Rychlost, výkon, propustnost, nízká latence</li>
<li>Škálovatelnost - jak do velikosti (gigabajty, terabajty, petabajty), tak do počtu prováděných operací za sekundu</li>
<li>ACID<ul>
<li><strong>Atomicity</strong>: celá transakce (série několika databázových operací) se provede celá, nebo vůbec</li>
<li><strong>Consistency</strong>: nesmí být narušena integrita dat, tj. podmínek definových v databázovém schématu (např. unikátní hodnoty, reference řádků mezi tabulkami...)</li>
<li><strong>Isolation</strong>: vícero současně probíhajících transakcí se nesmí navzájem ovlivnit</li>
<li><strong>Durability</strong>: jakmile je transakce dokončena, je zaznamenána trvalým způsobem, nesmaže ji např. výpadek napájení</li>
</ul>
</li>
</ul>
<p>Když se nad tím zamyslíte, jedná se o protichůdné požadavky. Tvůrci databázových systémů tak musí zvolit nějaký kompomis. Někdy lze databáze nakonfigurovat, zda má např. preferovat izolaci, nebo propustnost (viz <a href="https://www.postgresql.org/docs/9.5/transaction-iso.html">PostgreSQL Transaction Isolation</a>). Žádná databáze není "nejlepší" a vhodná na všechno. Zrovna co se týče rozdílu mezi "transakční" a "analytickou" databází, tak často pro tyto oblasti jsou vhodné odlišné systémy a přístupy.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Relační databáze</h2>
<p>Jde o typickou, klasickou, nejčastěji používanou kategorii databázových systémů. Používají se od 70. let, existuje okolo nich široký ekosystém se spoustou nástrojů a také lidí, kteří s nimi umí pracovat.</p>
<p>Co <a href="https://en.wikipedia.org/wiki/Relational_database">relační databáze</a> obsahuje:</p>
<ul>
<li>"databáze" (jeden databázový systém může spravovat několik databází)<ul>
<li>uživatelé (users)</li>
<li><strong>tabulky</strong><ul>
<li><strong>sloupce</strong></li>
<li>indexy</li>
<li>constraints</li>
<li>cizí klíče (foreign keys)</li>
<li>triggery</li>
</ul>
</li>
<li>pohledy (views)</li>
<li>procedury</li>
<li>sekvence</li>
</ul>
</li>
</ul>
<p>Data se ukládají v podobě řádek a sloupců do jednotlivých tabulek:</p>
<table>
<thead><tr>
<th style="text-align:left">title</th>
<th style="text-align:left">year</th>
<th style="text-align:left">director_name</th>
<th style="text-align:left">director_birthdate</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Pelíšky</td>
<td style="text-align:left">1999</td>
<td style="text-align:left">Jan Hřebejk</td>
<td style="text-align:left">1967-06-27</td>
</tr>
<tr>
<td style="text-align:left">Forrest Gump</td>
<td style="text-align:left">1994</td>
<td style="text-align:left">Robert Zemeckis</td>
<td style="text-align:left">1951-05-14</td>
</tr>
<tr>
<td style="text-align:left">Návrat do budoucnosti</td>
<td style="text-align:left">1985</td>
<td style="text-align:left">Robert Zemeckis</td>
<td style="text-align:left">1951-05-14</td>
</tr>
</tbody>
</table>
<p>Každý řádek je označen svým unikátním identifikátorem, a duplicitní data se <em>normalizují</em>:</p>
<table>
<thead><tr>
<th>movie_id</th>
<th style="text-align:left">title</th>
<th style="text-align:left">year</th>
<th style="text-align:left">director_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td style="text-align:left">Pelíšky</td>
<td style="text-align:left">1999</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td>2</td>
<td style="text-align:left">Forrest Gump</td>
<td style="text-align:left">1994</td>
<td style="text-align:left">2</td>
</tr>
<tr>
<td>3</td>
<td style="text-align:left">Návrat do budoucnosti</td>
<td style="text-align:left">1985</td>
<td style="text-align:left">2</td>
</tr>
</tbody>
</table>
<table>
<thead><tr>
<th>director_id</th>
<th style="text-align:left">name</th>
<th>birthdate</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td style="text-align:left">Jan Hřebejk</td>
<td>1967-06-27</td>
</tr>
<tr>
<td>2</td>
<td style="text-align:left">Robert Zemeckis</td>
<td>1951-05-14</td>
</tr>
</tbody>
</table>
<p>Vztah mezi režiséry a filmy je zde 1:N. Každý jeden režisér je provázán s několika filmy. Každý jeden film je provázán s jedním režisérem (a nebo žádným, pokud jeho director_id není vyplněno).</p>
<p>Co když chceme vyjádřit možnost, že jeden film může mít více než jednoho režiséra?</p>
<table>
<thead><tr>
<th>movie_id</th>
<th style="text-align:left">title</th>
<th style="text-align:left">year</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td style="text-align:left">Pelíšky</td>
<td style="text-align:left">1999</td>
</tr>
<tr>
<td>2</td>
<td style="text-align:left">Forrest Gump</td>
<td style="text-align:left">1994</td>
</tr>
<tr>
<td>3</td>
<td style="text-align:left">Návrat do budoucnosti</td>
<td style="text-align:left">1985</td>
</tr>
</tbody>
</table>
<table>
<thead><tr>
<th>director_id</th>
<th style="text-align:left">name</th>
<th>birthdate</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td style="text-align:left">Jan Hřebejk</td>
<td>1967-06-27</td>
</tr>
<tr>
<td>2</td>
<td style="text-align:left">Robert Zemeckis</td>
<td>1951-05-14</td>
</tr>
<tr>
<td>3</td>
<td style="text-align:left">Joe Smith</td>
<td>1950-01-01</td>
</tr>
</tbody>
</table>
<table>
<thead><tr>
<th>movie_id</th>
<th>director_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>SQL</h2>
<p>SQL je jazyk, kterým komunikujeme s relační databází. Umí vyjádřit různé operace nad tabulkami - výběr sloupců, řádků, vztahy mezi více tabulkami, agregace hodnot z více řádků... (Nepřípomíná vám to něco? Pandas DataFrame? :) )</p>
<p>Příklad:</p>
<div class="highlight"><pre><code>SELECT title, year FROM movies;

UPDATE directors SET birthdate = "1950-01-02" WHERE director_id = 3;</code></pre></div><p>Dokonce i jiný software, než jsou relační databáze, rozumí SQL. Často právě analytické nástroje, data lakes, Amazon S3... Pak existuje spousta databází a jazyků, které se jazykem SQL inspirovaly - např. databáze Cassandra a její jazyk CQL.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Instalace a import SQLAlchemy</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Každá databáze se z Pythonu používá trochu jinak - liší se název modulu, který je potřeba importovat, mírně se liší způsob předávání dat použitých v SQL dotazech, liší se forma dat vrácených ve výsledku... Použijeme proto knihovnu <a href="https://www.sqlalchemy.org/">SQLAlchemy</a>, která tyto detaily <em>abstrahuje</em> a poskytuje rozhraní stejné pro všechny databáze (které SQLAlchemy podporuje).</p>
<p>SQLAlchemy se skládá ze <a href="https://docs.sqlalchemy.org/en/13/">dvou částí</a>:</p>
<ul>
<li>Core - to je právě ta zmíněná abstrakce základních operací s databází, tuto část budeme používat<ul>
<li>engine, connections, transactions</li>
<li>table metadata</li>
<li>SQL expression language</li>
</ul>
</li>
<li><a href="https://docs.sqlalchemy.org/en/13/orm/tutorial.html">ORM</a> - umožňuje pracovat s daty v databázi prostřednistvím mapování na objekty<ul>
<li>zajímavé hlavně při psaní větších aplikací (webových aplikací apod.)</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Instalaci knihovny <a href="https://www.sqlalchemy.org/">SQLAlchemy</a> provedeme přes pip (nezapomeňte mít aktivovaný venv, do kterého to chcete instalovat):</p>
<div class="highlight"><pre><code>pip install sqlalchemy</code></pre></div><p>Případně lze instalaci spustit přímo z Jupyteru:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="n">pip</span> <span class="n">install</span> <span class="n">sqlalchemy</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Requirement already satisfied: sqlalchemy in /opt/local/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages (1.3.13)
Note: you may need to restart the kernel to use updated packages.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Knihovnu SQLAlchemy naimportujeme:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sqlalchemy</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Jako vždy, naimportujeme i <a href="https://pandas.pydata.org/pandas-docs/stable/reference/index.html">Pandas</a>:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Stažení filmové databáze</h2>
<p>Pro ukázku práce s databází použijeme data od Míry Brabence.
Jde o databázi typu <a href="https://cs.wikipedia.org/wiki/SQLite">SQLite</a> - skládá se z jediného souboru, ve kterém jsou všecha data. To znamená, že není žádný velký server, ke kterému byste se připojovaly jménem a heslem, jako u "klasických" databází (PostgreSQL, Oracle, MS SQL...).
Databáze v podobě SQLite souboru má výhodu v tom, že když něco rozbijete, tak ten soubor prostě smažete a uděláte si nový :)</p>
<p>Soubor s databází stáhneme knihovnou <a href="https://requests.readthedocs.io/en/master/">Requests</a>, kterou už máte nainstalovanou (instrukce byly v první hodině)
a uložíme ho do souboru v pracovním adresáři, tj. tam, odkud jste spustili Jupyter Notebook.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="k">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">requests</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">db_data</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://github.com/messa/movie-db-2020/raw/master/movies.sqlite&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>
<span class="n">Path</span><span class="p">(</span><span class="s1">&#39;movies.sqlite&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">db_data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[5]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>1421312</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Otevření databáze, průzkum struktury</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:///movies.sqlite&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Objekt <code>engine</code> obsahuje připojení do databáze a skrz něj budeme provádět operace s danou databází.</p>
<p>Začneme tím, že se podíváme, jaká je struktura té databáze - jaké tabulky obsahuje a co obsahují ty tabulky. Každá databáze na to má jiné finty, jak toto zjistit (někdy funguje SQL příkaz <code>SHOW TABLES</code>, jindy je zase potřeba <code>SELECT</code> z metadat), naštěstí SQLAlchemy nám s tím pomůže.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span><span class="o">.</span><span class="n">get_table_names</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[7]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>[&#39;actors&#39;, &#39;movie_to_actor&#39;, &#39;movies&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">prozkoumat</span><span class="p">(</span><span class="n">engine</span><span class="p">):</span>
    <span class="n">inspector</span> <span class="o">=</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">schema</span> <span class="ow">in</span> <span class="n">inspector</span><span class="o">.</span><span class="n">get_schema_names</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Schema:&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">inspector</span><span class="o">.</span><span class="n">get_table_names</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Table:&#39;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">inspector</span><span class="o">.</span><span class="n">get_columns</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;      Column:&#39;</span><span class="p">,</span> <span class="n">column</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span> <span class="n">column</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">prozkoumat</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Schema: main

  Table: actors

      Column: id           INTEGER
      Column: csfd_url     VARCHAR
      Column: name         VARCHAR
      Column: birth_date   DATE

  Table: movie_to_actor

      Column: id           INTEGER
      Column: movie_id     INTEGER
      Column: actor_id     INTEGER

  Table: movies

      Column: id           INTEGER
      Column: title        VARCHAR
      Column: csfd_url     VARCHAR
      Column: year         INTEGER
      Column: rating       NUMERIC
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Na prozkoumání struktury a obsahu databáze můžete použít nějaký specializovaný program - <a href="https://sqlitebrowser.org/">DB Browser</a>, <a href="https://dbeaver.io/">DBeaver</a>, <a href="https://www.mysql.com/products/workbench/">MySQL Workbench</a>, ... je jich hodně, typicky se specializují na konkrétní druh databáze, některé programy jsou zdarma a některé placené. Existují i webové aplikace, nejznámější asi český <a href="https://www.adminer.org/">Adminer</a>. Zde jsem vám chtěl ukázat, že toho samého se dá dosáhnout i takto z Pythonu.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Poznámka: struktura této databáze je trochu jiná, než byl motivační příklad na začátku.
Nemáme tu <code>directors</code>, máme tu <code>actors</code>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>SELECT</h2>
<p>Ukážeme si několik způsobů, jak data z databáze "vytáhnout" do Pythonu.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id, name, birth_date FROM actors&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[10]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>&lt;sqlalchemy.engine.result.ResultProxy at 0x11522c5d0&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Výsledkem volání <code>engine.execute(...)</code> je objekt, který umí reprezentuje výsledek SQL dotazu. V případě SELECT se skrz tento objekt dají procházet získané řádky, v případě operací INSERT, UPDATE, DELETE tento objekt obsahuje např. počet změněných řádek.</p>
<p>Zkusíme si zobrazit jednotlivé řádky. LIMIT slouží k omezení počtu vracených záznamů.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id, name, birth_date FROM actors LIMIT 5&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>(1, &#39;Tim Robbins&#39;, &#39;1958-10-16&#39;)
(2, &#39;Morgan Freeman&#39;, &#39;1937-06-01&#39;)
(3, &#39;Bob Gunton&#39;, &#39;1945-11-15&#39;)
(4, &#39;William Sadler&#39;, &#39;1950-04-13&#39;)
(5, &#39;Clancy Brown&#39;, &#39;1959-01-05&#39;)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Zdálo by se, že procházení <code>result</code> vrací n-tice (tuple), ale není tomu tak.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id, name, birth_date FROM actors LIMIT 5&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;sqlalchemy.engine.result.RowProxy&#39;&gt;
&lt;class &#39;sqlalchemy.engine.result.RowProxy&#39;&gt;
&lt;class &#39;sqlalchemy.engine.result.RowProxy&#39;&gt;
&lt;class &#39;sqlalchemy.engine.result.RowProxy&#39;&gt;
&lt;class &#39;sqlalchemy.engine.result.RowProxy&#39;&gt;
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Jde o SQLAlchemy objekt RowProxy, který umí pár zajímavých věcí:</p>
<ul>
<li>vrátit hodnotu daného sloupce podle pořadí – např. <code>row[2]</code></li>
<li>vrátit hodnotu daného sloupce podle názvu – např. <code>row["name"]</code></li>
<li>vrátit dict s hodnotami – např. <code>dict(row)</code></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id, name, csfd_url FROM actors LIMIT 5&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>1 Tim Robbins
2 Morgan Freeman
3 Bob Gunton
4 William Sadler
5 Clancy Brown
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Poznámka: sloupce vyjmenované za <code>SELECT</code> mohou být v jakémkoli pořadí. Stejně tak vytahávat si je z toho <code>RowProxy</code> objektu také můžeme libovolně v jakémkoli pořadí.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT name, id, csfd_url FROM actors LIMIT 5&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>https://www.csfd.cz/tvurce/103-tim-robbins/ Tim Robbins
https://www.csfd.cz/tvurce/92-morgan-freeman/ Morgan Freeman
https://www.csfd.cz/tvurce/202-bob-gunton/ Bob Gunton
https://www.csfd.cz/tvurce/203-william-sadler/ William Sadler
https://www.csfd.cz/tvurce/204-clancy-brown/ Clancy Brown
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Pomocí <code>SELECT *</code> si vytáhneme všechny dostupné sloupce:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM actors LIMIT 5&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>(1, &#39;https://www.csfd.cz/tvurce/103-tim-robbins/&#39;, &#39;Tim Robbins&#39;, &#39;1958-10-16&#39;)
(2, &#39;https://www.csfd.cz/tvurce/92-morgan-freeman/&#39;, &#39;Morgan Freeman&#39;, &#39;1937-06-01&#39;)
(3, &#39;https://www.csfd.cz/tvurce/202-bob-gunton/&#39;, &#39;Bob Gunton&#39;, &#39;1945-11-15&#39;)
(4, &#39;https://www.csfd.cz/tvurce/203-william-sadler/&#39;, &#39;William Sadler&#39;, &#39;1950-04-13&#39;)
(5, &#39;https://www.csfd.cz/tvurce/204-clancy-brown/&#39;, &#39;Clancy Brown&#39;, &#39;1959-01-05&#39;)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Asi bude lepší místo <code>row[2]</code> používat např. <code>row["name"]</code>,
nebo si to převést celé do slovníku přes <code>dict(row)</code>:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM actors LIMIT 5&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;birth_date&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>1 Tim Robbins 1958-10-16
2 Morgan Freeman 1937-06-01
3 Bob Gunton 1945-11-15
4 William Sadler 1950-04-13
5 Clancy Brown 1959-01-05
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM actors LIMIT 5&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>{&#39;id&#39;: 1, &#39;csfd_url&#39;: &#39;https://www.csfd.cz/tvurce/103-tim-robbins/&#39;, &#39;name&#39;: &#39;Tim Robbins&#39;, &#39;birth_date&#39;: &#39;1958-10-16&#39;}
{&#39;id&#39;: 2, &#39;csfd_url&#39;: &#39;https://www.csfd.cz/tvurce/92-morgan-freeman/&#39;, &#39;name&#39;: &#39;Morgan Freeman&#39;, &#39;birth_date&#39;: &#39;1937-06-01&#39;}
{&#39;id&#39;: 3, &#39;csfd_url&#39;: &#39;https://www.csfd.cz/tvurce/202-bob-gunton/&#39;, &#39;name&#39;: &#39;Bob Gunton&#39;, &#39;birth_date&#39;: &#39;1945-11-15&#39;}
{&#39;id&#39;: 4, &#39;csfd_url&#39;: &#39;https://www.csfd.cz/tvurce/203-william-sadler/&#39;, &#39;name&#39;: &#39;William Sadler&#39;, &#39;birth_date&#39;: &#39;1950-04-13&#39;}
{&#39;id&#39;: 5, &#39;csfd_url&#39;: &#39;https://www.csfd.cz/tvurce/204-clancy-brown/&#39;, &#39;name&#39;: &#39;Clancy Brown&#39;, &#39;birth_date&#39;: &#39;1959-01-05&#39;}
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Z dat lze vytvořit i <strong>Pandas DataFrame</strong>:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM actors&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[18]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>csfd_url</th>
      <th>name</th>
      <th>birth_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>https://www.csfd.cz/tvurce/103-tim-robbins/</td>
      <td>Tim Robbins</td>
      <td>1958-10-16</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>https://www.csfd.cz/tvurce/92-morgan-freeman/</td>
      <td>Morgan Freeman</td>
      <td>1937-06-01</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>https://www.csfd.cz/tvurce/202-bob-gunton/</td>
      <td>Bob Gunton</td>
      <td>1945-11-15</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>https://www.csfd.cz/tvurce/203-william-sadler/</td>
      <td>William Sadler</td>
      <td>1950-04-13</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>https://www.csfd.cz/tvurce/204-clancy-brown/</td>
      <td>Clancy Brown</td>
      <td>1959-01-05</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7522</th>
      <td>7523</td>
      <td>https://www.csfd.cz/tvurce/147104-jon-kenny/</td>
      <td>Jon Kenny</td>
      <td>None</td>
    </tr>
    <tr>
      <th>7523</th>
      <td>7524</td>
      <td>https://www.csfd.cz/tvurce/147105-lisa-hannigan/</td>
      <td>Lisa Hannigan</td>
      <td>1981-02-12</td>
    </tr>
    <tr>
      <th>7524</th>
      <td>7525</td>
      <td>https://www.csfd.cz/tvurce/162204-lucy-o-connell/</td>
      <td>Lucy O'Connell</td>
      <td>None</td>
    </tr>
    <tr>
      <th>7525</th>
      <td>7526</td>
      <td>https://www.csfd.cz/tvurce/309228-paul-young/</td>
      <td>Paul Young</td>
      <td>None</td>
    </tr>
    <tr>
      <th>7526</th>
      <td>7527</td>
      <td>https://www.csfd.cz/tvurce/458624-grethe-mogen...</td>
      <td>Grethe Mogensen</td>
      <td>1937-05-25</td>
    </tr>
  </tbody>
</table>
<p>7527 rows × 4 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Toto je zkratka pro načtení celé tabulky:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_table</span><span class="p">(</span><span class="s1">&#39;actors&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[19]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>csfd_url</th>
      <th>name</th>
      <th>birth_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>https://www.csfd.cz/tvurce/103-tim-robbins/</td>
      <td>Tim Robbins</td>
      <td>1958-10-16</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>https://www.csfd.cz/tvurce/92-morgan-freeman/</td>
      <td>Morgan Freeman</td>
      <td>1937-06-01</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>https://www.csfd.cz/tvurce/202-bob-gunton/</td>
      <td>Bob Gunton</td>
      <td>1945-11-15</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>https://www.csfd.cz/tvurce/203-william-sadler/</td>
      <td>William Sadler</td>
      <td>1950-04-13</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>https://www.csfd.cz/tvurce/204-clancy-brown/</td>
      <td>Clancy Brown</td>
      <td>1959-01-05</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7522</th>
      <td>7523</td>
      <td>https://www.csfd.cz/tvurce/147104-jon-kenny/</td>
      <td>Jon Kenny</td>
      <td>NaT</td>
    </tr>
    <tr>
      <th>7523</th>
      <td>7524</td>
      <td>https://www.csfd.cz/tvurce/147105-lisa-hannigan/</td>
      <td>Lisa Hannigan</td>
      <td>1981-02-12</td>
    </tr>
    <tr>
      <th>7524</th>
      <td>7525</td>
      <td>https://www.csfd.cz/tvurce/162204-lucy-o-connell/</td>
      <td>Lucy O'Connell</td>
      <td>NaT</td>
    </tr>
    <tr>
      <th>7525</th>
      <td>7526</td>
      <td>https://www.csfd.cz/tvurce/309228-paul-young/</td>
      <td>Paul Young</td>
      <td>NaT</td>
    </tr>
    <tr>
      <th>7526</th>
      <td>7527</td>
      <td>https://www.csfd.cz/tvurce/458624-grethe-mogen...</td>
      <td>Grethe Mogensen</td>
      <td>1937-05-25</td>
    </tr>
  </tbody>
</table>
<p>7527 rows × 4 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Průzkum dat ve filmové databázi</h2>
<p>Data z jednotlivých tabulek si nahrajeme do Pandas DataFramů, se kterými budeme dále pracovat.</p>
<p>Pro přehlednost si zde vypíšeme ukázku obsahu těch DataFramů, abychom věděli, s čím pracujeme.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span><span class="o">.</span><span class="n">get_table_names</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[20]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>[&#39;actors&#39;, &#39;movie_to_actor&#39;, &#39;movies&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">actors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_table</span><span class="p">(</span><span class="s1">&#39;actors&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>
<span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_table</span><span class="p">(</span><span class="s1">&#39;movies&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>
<span class="n">movie_to_actor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_table</span><span class="p">(</span><span class="s1">&#39;movie_to_actor&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">actors</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[22]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>csfd_url</th>
      <th>name</th>
      <th>birth_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>https://www.csfd.cz/tvurce/103-tim-robbins/</td>
      <td>Tim Robbins</td>
      <td>1958-10-16</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>https://www.csfd.cz/tvurce/92-morgan-freeman/</td>
      <td>Morgan Freeman</td>
      <td>1937-06-01</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>https://www.csfd.cz/tvurce/202-bob-gunton/</td>
      <td>Bob Gunton</td>
      <td>1945-11-15</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>https://www.csfd.cz/tvurce/203-william-sadler/</td>
      <td>William Sadler</td>
      <td>1950-04-13</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>https://www.csfd.cz/tvurce/204-clancy-brown/</td>
      <td>Clancy Brown</td>
      <td>1959-01-05</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">movies</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[23]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>title</th>
      <th>csfd_url</th>
      <th>year</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Vykoupení z věznice Shawshank</td>
      <td>https://www.csfd.cz/film/2294-vykoupeni-z-vezn...</td>
      <td>1994</td>
      <td>95.3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Forrest Gump</td>
      <td>https://www.csfd.cz/film/10135-forrest-gump/</td>
      <td>1994</td>
      <td>94.5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Zelená míle</td>
      <td>https://www.csfd.cz/film/2292-zelena-mile/</td>
      <td>1999</td>
      <td>92.8</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Přelet nad kukaččím hnízdem</td>
      <td>https://www.csfd.cz/film/2982-prelet-nad-kukac...</td>
      <td>1975</td>
      <td>92.5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Sedm</td>
      <td>https://www.csfd.cz/film/2671-sedm/</td>
      <td>1995</td>
      <td>92.4</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">movie_to_actor</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[24]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>movie_id</th>
      <th>actor_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>1</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>SELECT ... WHERE ... AND/OR</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    SELECT * FROM actors </span>
<span class="s1">    WHERE birth_date &gt; &quot;2000-01-01&quot; AND birth_date &lt; &quot;2001-01-01&quot;</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[25]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>[(4849, &#39;https://www.csfd.cz/tvurce/39309-medved-bart-2/&#39;, &#39;medvěd Bart 2&#39;, &#39;2000-01-20&#39;),
 (5703, &#39;https://www.csfd.cz/tvurce/283519-zaira-wasim/&#39;, &#39;Zaira Wasim&#39;, &#39;2000-10-23&#39;),
 (6290, &#39;https://www.csfd.cz/tvurce/35296-morgan-lily/&#39;, &#39;Morgan Lily&#39;, &#39;2000-04-11&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">actors</span><span class="p">[(</span><span class="n">actors</span><span class="p">[</span><span class="s1">&#39;birth_date&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;2000-01-01&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">actors</span><span class="p">[</span><span class="s1">&#39;birth_date&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;2001-01-01&#39;</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[26]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>csfd_url</th>
      <th>name</th>
      <th>birth_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4848</th>
      <td>4849</td>
      <td>https://www.csfd.cz/tvurce/39309-medved-bart-2/</td>
      <td>medvěd Bart 2</td>
      <td>2000-01-20</td>
    </tr>
    <tr>
      <th>5702</th>
      <td>5703</td>
      <td>https://www.csfd.cz/tvurce/283519-zaira-wasim/</td>
      <td>Zaira Wasim</td>
      <td>2000-10-23</td>
    </tr>
    <tr>
      <th>6289</th>
      <td>6290</td>
      <td>https://www.csfd.cz/tvurce/35296-morgan-lily/</td>
      <td>Morgan Lily</td>
      <td>2000-04-11</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>SELECT ... ORDER BY</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">   SELECT * FROM actors </span>
<span class="s1">   WHERE birth_date &gt; &quot;2005-01-01&quot; </span>
<span class="s1">   ORDER BY birth_date ASC&#39;&#39;&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[27]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>[(526, &#39;https://www.csfd.cz/tvurce/239127-noah-jupe/&#39;, &#39;Noah Jupe&#39;, &#39;2005-02-25&#39;),
 (7051, &#39;https://www.csfd.cz/tvurce/321955-rocco-lerro/&#39;, &#39;Rocco Lerro&#39;, &#39;2005-08-21&#39;),
 (4979, &#39;https://www.csfd.cz/tvurce/357987-ariana-greenblatt/&#39;, &#39;Ariana Greenblatt&#39;, &#39;2007-08-27&#39;),
 (1876, &#39;https://www.csfd.cz/tvurce/540779-hailey-hermida/&#39;, &#39;Hailey Hermida&#39;, &#39;2007-09-13&#39;),
 (1865, &#39;https://www.csfd.cz/tvurce/354371-pierce-pope/&#39;, &#39;Pierce Pope&#39;, &#39;2008-06-02&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">actors</span><span class="p">[(</span><span class="n">actors</span><span class="p">[</span><span class="s1">&#39;birth_date&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;2005-01-01&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;birth_date&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[28]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>csfd_url</th>
      <th>name</th>
      <th>birth_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>525</th>
      <td>526</td>
      <td>https://www.csfd.cz/tvurce/239127-noah-jupe/</td>
      <td>Noah Jupe</td>
      <td>2005-02-25</td>
    </tr>
    <tr>
      <th>7050</th>
      <td>7051</td>
      <td>https://www.csfd.cz/tvurce/321955-rocco-lerro/</td>
      <td>Rocco Lerro</td>
      <td>2005-08-21</td>
    </tr>
    <tr>
      <th>4978</th>
      <td>4979</td>
      <td>https://www.csfd.cz/tvurce/357987-ariana-green...</td>
      <td>Ariana Greenblatt</td>
      <td>2007-08-27</td>
    </tr>
    <tr>
      <th>1875</th>
      <td>1876</td>
      <td>https://www.csfd.cz/tvurce/540779-hailey-hermida/</td>
      <td>Hailey Hermida</td>
      <td>2007-09-13</td>
    </tr>
    <tr>
      <th>1864</th>
      <td>1865</td>
      <td>https://www.csfd.cz/tvurce/354371-pierce-pope/</td>
      <td>Pierce Pope</td>
      <td>2008-06-02</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Při řazení podle více sloupců pozor na pořadí :)</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">   SELECT title, year, rating FROM movies </span>
<span class="s1">   WHERE rating &gt; 90 AND year &gt;= 2000</span>
<span class="s1">   ORDER BY year ASC, title DESC</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[29]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>year</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Pán prstenů: Společenstvo Prstenu</td>
      <td>2001</td>
      <td>90.4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Pán prstenů: Návrat krále</td>
      <td>2003</td>
      <td>90.3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Temný rytíř</td>
      <td>2008</td>
      <td>90.2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Gran Torino</td>
      <td>2008</td>
      <td>90.3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Nedotknutelní</td>
      <td>2011</td>
      <td>91.3</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Le Mans '66</td>
      <td>2019</td>
      <td>90.5</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Gentlemani</td>
      <td>2019</td>
      <td>90.4</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">movies</span><span class="p">[(</span><span class="n">movies</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">movies</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2000</span><span class="p">)]</span> \
  <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;rating&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[30]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>title</th>
      <th>csfd_url</th>
      <th>year</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>16</th>
      <td>17</td>
      <td>Pán prstenů: Společenstvo Prstenu</td>
      <td>https://www.csfd.cz/film/4711-pan-prstenu-spol...</td>
      <td>2001</td>
      <td>90.4</td>
    </tr>
    <tr>
      <th>17</th>
      <td>18</td>
      <td>Pán prstenů: Návrat krále</td>
      <td>https://www.csfd.cz/film/4712-pan-prstenu-navr...</td>
      <td>2003</td>
      <td>90.3</td>
    </tr>
    <tr>
      <th>19</th>
      <td>20</td>
      <td>Temný rytíř</td>
      <td>https://www.csfd.cz/film/223734-temny-rytir/</td>
      <td>2008</td>
      <td>90.2</td>
    </tr>
    <tr>
      <th>18</th>
      <td>19</td>
      <td>Gran Torino</td>
      <td>https://www.csfd.cz/film/240479-gran-torino/</td>
      <td>2008</td>
      <td>90.3</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>Nedotknutelní</td>
      <td>https://www.csfd.cz/film/306731-nedotknutelni/</td>
      <td>2011</td>
      <td>91.3</td>
    </tr>
    <tr>
      <th>21</th>
      <td>22</td>
      <td>Gentlemani</td>
      <td>https://www.csfd.cz/film/675173-gentlemani/</td>
      <td>2019</td>
      <td>90.4</td>
    </tr>
    <tr>
      <th>15</th>
      <td>16</td>
      <td>Le Mans '66</td>
      <td>https://www.csfd.cz/film/332773-le-mans-66/</td>
      <td>2019</td>
      <td>90.5</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>SELECT ... GROUP BY</h2>
<p>GROUP BY umožňuje "shluknout" řádky do <em>skupin</em>, a nad těmito skupinami pak provádět agregační funkce (MIN, MAX, AVG, COUNT apod.).</p>
<p>Tyto skupiny pak lze dále filtrovat pomocí HAVING (podobně jako WHERE filtruje <em>řádky</em>, a to <em>předtím</em>, než se z nich vytvářejí ty <em>skupiny</em>).</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    SELECT year, COUNT(*) FROM movies GROUP BY year </span>
<span class="s1">    HAVING COUNT(*) &gt; 5 ORDER BY COUNT(*) DESC &#39;&#39;&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[31]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>[(1993, 11),
 (2004, 9),
 (1999, 9),
 (2001, 8),
 (1997, 8),
 (1995, 7),
 (1990, 7),
 (1986, 7),
 (2008, 6),
 (2003, 6),
 (2002, 6),
 (2000, 6),
 (1998, 6),
 (1991, 6),
 (1984, 6),
 (1980, 6),
 (1973, 6),
 (1968, 6),
 (1957, 6)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    SELECT year, COUNT(id), MIN(rating), AVG(rating), MAX(rating) </span>
<span class="s1">    FROM movies </span>
<span class="s1">    WHERE rating &gt; 10</span>
<span class="s1">    GROUP BY year</span>
<span class="s1">    HAVING COUNT(id) &gt; 7</span>
<span class="s1">    ORDER BY year DESC</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[32]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>COUNT(id)</th>
      <th>MIN(rating)</th>
      <th>AVG(rating)</th>
      <th>MAX(rating)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2004</td>
      <td>9</td>
      <td>84.5</td>
      <td>85.777778</td>
      <td>87.9</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2001</td>
      <td>8</td>
      <td>84.7</td>
      <td>86.850000</td>
      <td>90.4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1999</td>
      <td>9</td>
      <td>84.6</td>
      <td>87.922222</td>
      <td>92.8</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1997</td>
      <td>8</td>
      <td>84.6</td>
      <td>86.587500</td>
      <td>89.1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1993</td>
      <td>11</td>
      <td>84.6</td>
      <td>86.027273</td>
      <td>92.3</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To GROUP BY je potřeba, protože bez toho se bude <em>celá</em> tabulka považovat za jedinou <em>skupinu</em> a použití agregačních funkcí způsobí to, že se vám vrátí jen jeden řádek výsledků:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[33]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    SELECT COUNT(*), MIN(birth_date), MAX(birth_date)</span>
<span class="s1">    FROM actors </span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[33]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>COUNT(*)</th>
      <th>MIN(birth_date)</th>
      <th>MAX(birth_date)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7527</td>
      <td>1857-11-11</td>
      <td>2008-06-02</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Jaký je rozdíl mezi <code>COUNT(*)</code>, <code>COUNT(id)</code> a <code>COUNT(něco)</code>?</p>
<p><code>COUNT(*)</code> vrací počet řádků. <code>COUNT(sloupec)</code> vrací počet řádků, ve kterých je v daném sloupci nějaká hodnota (tj. není tam NULL). Pokud tím sloupcem je <code>id</code>, který je téměř vždy NON-NULL, tak je <code>COUNT(id)</code> a <code>COUNT(*)</code> vlastně to samé :)</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    SELECT COUNT(*), COUNT(id), COUNT(birth_date) </span>
<span class="s1">    FROM actors </span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[34]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>COUNT(*)</th>
      <th>COUNT(id)</th>
      <th>COUNT(birth_date)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7527</td>
      <td>7527</td>
      <td>5753</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Jak je vidět, u některých herců není vyplněno <code>birth_date</code>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Struktura SQL dotazu</h2>
<p>Ještě rekapitulace, jak se probíhá provádění SQL dotazu :)</p>
<ol>
<li>databáze vezme tabulky vyjmenované ve FROM</li>
<li>databáze čte řádky (jeden po druhém)</li>
<li>ty řádky se filtrují podle uvedených WHERE výrazů</li>
<li>přefiltrované řádky se seskupí podle GROUP BY výrazů do skupin</li>
<li>ty skupiny se filtrují pode uvedených HAVING výrazů</li>
<li>výsledek se seřadí podle ORDER BY</li>
<li>výsledek se ořízne podle LIMIT</li>
</ol>
<p>Probrali jsme jen to nejdůležitější. Pro představu, jaké jsou možnosti zápisu SELECT dotazu
(převzato z <a href="https://www.sqlite.org/lang_select.html">dokumentace SQLite</a>):</p>
<div><br><img src="https://www.sqlite.org/images/syntax/select-stmt.gif"><br></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Úkol: který herec účinkoval v největším počtu filmů</h2>
<p>Najděte v tabulce <code>movie_to_actor</code> id herce, u kterého je v té tabulce nejvíce id filmů.</p>
<p>Postup:</p>
<ol>
<li>Pomocí GROUP BY si vypište vždy actor_id a k tomu počet řádků s tímto actor_id</li>
<li>Pomocí ORDER BY a LIMIT zjistěte actor_id, u kterého je tento počet nejvyšší</li>
<li>Bonus: zjistěte jméno tohoto herce</li>
</ol>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>JOIN</h2>
<p>JOIN je v SQL to samé, co je merge v DataFrame (viz některá předchozí hodina).</p>
<div><img src="https://naucse.python.cz/2020/pydata-praha-jaro/pydata/pandas_correlations/static/joins.svg"></div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    SELECT movie_id, title, actor_id, name, a.id, m.id AS idecko_filmu</span>
<span class="s1">    FROM actors              AS a</span>
<span class="s1">    LEFT JOIN movie_to_actor AS ma ON a.id = ma.actor_id</span>
<span class="s1">    LEFT JOIN movies         AS m  ON m.id = ma.movie_id</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[35]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>movie_id</th>
      <th>title</th>
      <th>actor_id</th>
      <th>name</th>
      <th>id</th>
      <th>idecko_filmu</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Vykoupení z věznice Shawshank</td>
      <td>1</td>
      <td>Tim Robbins</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>Vykoupení z věznice Shawshank</td>
      <td>2</td>
      <td>Morgan Freeman</td>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5</td>
      <td>Sedm</td>
      <td>2</td>
      <td>Morgan Freeman</td>
      <td>2</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>20</td>
      <td>Temný rytíř</td>
      <td>2</td>
      <td>Morgan Freeman</td>
      <td>2</td>
      <td>20</td>
    </tr>
    <tr>
      <th>4</th>
      <td>64</td>
      <td>Million Dollar Baby</td>
      <td>2</td>
      <td>Morgan Freeman</td>
      <td>2</td>
      <td>64</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9806</th>
      <td>300</td>
      <td>Píseň moře</td>
      <td>7523</td>
      <td>Jon Kenny</td>
      <td>7523</td>
      <td>300</td>
    </tr>
    <tr>
      <th>9807</th>
      <td>300</td>
      <td>Píseň moře</td>
      <td>7524</td>
      <td>Lisa Hannigan</td>
      <td>7524</td>
      <td>300</td>
    </tr>
    <tr>
      <th>9808</th>
      <td>300</td>
      <td>Píseň moře</td>
      <td>7525</td>
      <td>Lucy O'Connell</td>
      <td>7525</td>
      <td>300</td>
    </tr>
    <tr>
      <th>9809</th>
      <td>300</td>
      <td>Píseň moře</td>
      <td>7526</td>
      <td>Paul Young</td>
      <td>7526</td>
      <td>300</td>
    </tr>
    <tr>
      <th>9810</th>
      <td>300</td>
      <td>Píseň moře</td>
      <td>7527</td>
      <td>Grethe Mogensen</td>
      <td>7527</td>
      <td>300</td>
    </tr>
  </tbody>
</table>
<p>9811 rows × 6 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>CREATE TABLE</h2>
<p>Pokud budeme chtít vytvořit novou tabulku, používá se k tomu příkaz CREATE TABLE.
Musíme vyjmenovat názvy a typy sloupců, které v tabulce chceme mít.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[39]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        CREATE TABLE phonebook (</span>
<span class="s1">          id INT PRIMARY KEY,</span>
<span class="s1">          name VARCHAR,</span>
<span class="s1">          phone_number VARCHAR</span>
<span class="s1">        ) </span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">OperationalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;database is locked&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Zkus zabit kernel a znovu spustit primo tento prikaz :/ Me&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">OperationalError</span>                          Traceback (most recent call last)
<span class="ansi-green-fg">/opt/local/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/sqlalchemy/engine/base.py</span> in <span class="ansi-cyan-fg">_execute_context</span><span class="ansi-blue-fg">(self, dialect, constructor, statement, parameters, *args)</span>
<span class="ansi-green-intense-fg ansi-bold">   1245</span>                     self.dialect.do_execute(
<span class="ansi-green-fg">-&gt; 1246</span><span class="ansi-red-fg">                         </span>cursor<span class="ansi-blue-fg">,</span> statement<span class="ansi-blue-fg">,</span> parameters<span class="ansi-blue-fg">,</span> context
<span class="ansi-green-intense-fg ansi-bold">   1247</span>                     )

<span class="ansi-green-fg">/opt/local/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/sqlalchemy/engine/default.py</span> in <span class="ansi-cyan-fg">do_execute</span><span class="ansi-blue-fg">(self, cursor, statement, parameters, context)</span>
<span class="ansi-green-intense-fg ansi-bold">    587</span>     <span class="ansi-green-fg">def</span> do_execute<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> cursor<span class="ansi-blue-fg">,</span> statement<span class="ansi-blue-fg">,</span> parameters<span class="ansi-blue-fg">,</span> context<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 588</span><span class="ansi-red-fg">         </span>cursor<span class="ansi-blue-fg">.</span>execute<span class="ansi-blue-fg">(</span>statement<span class="ansi-blue-fg">,</span> parameters<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    589</span> 

<span class="ansi-red-fg">OperationalError</span>: database is locked

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">OperationalError</span>                          Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-39-32fb8e6f855b&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>       phone_number VARCHAR
<span class="ansi-green-intense-fg ansi-bold">      6</span>     ) 
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg"> &#39;&#39;&#39;)
</span>
<span class="ansi-green-fg">/opt/local/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/sqlalchemy/engine/base.py</span> in <span class="ansi-cyan-fg">execute</span><span class="ansi-blue-fg">(self, statement, *multiparams, **params)</span>
<span class="ansi-green-intense-fg ansi-bold">   2180</span> 
<span class="ansi-green-intense-fg ansi-bold">   2181</span>         connection <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_contextual_connect<span class="ansi-blue-fg">(</span>close_with_result<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">-&gt; 2182</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> connection<span class="ansi-blue-fg">.</span>execute<span class="ansi-blue-fg">(</span>statement<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>multiparams<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>params<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   2183</span> 
<span class="ansi-green-intense-fg ansi-bold">   2184</span>     <span class="ansi-green-fg">def</span> scalar<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> statement<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>multiparams<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>params<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/opt/local/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/sqlalchemy/engine/base.py</span> in <span class="ansi-cyan-fg">execute</span><span class="ansi-blue-fg">(self, object_, *multiparams, **params)</span>
<span class="ansi-green-intense-fg ansi-bold">    974</span>         &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    975</span>         <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>object_<span class="ansi-blue-fg">,</span> util<span class="ansi-blue-fg">.</span>string_types<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 976</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_execute_text<span class="ansi-blue-fg">(</span>object_<span class="ansi-blue-fg">,</span> multiparams<span class="ansi-blue-fg">,</span> params<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    977</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    978</span>             meth <span class="ansi-blue-fg">=</span> object_<span class="ansi-blue-fg">.</span>_execute_on_connection

<span class="ansi-green-fg">/opt/local/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/sqlalchemy/engine/base.py</span> in <span class="ansi-cyan-fg">_execute_text</span><span class="ansi-blue-fg">(self, statement, multiparams, params)</span>
<span class="ansi-green-intense-fg ansi-bold">   1147</span>             parameters<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   1148</span>             statement<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">-&gt; 1149</span><span class="ansi-red-fg">             </span>parameters<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   1150</span>         )
<span class="ansi-green-intense-fg ansi-bold">   1151</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>_has_events <span class="ansi-green-fg">or</span> self<span class="ansi-blue-fg">.</span>engine<span class="ansi-blue-fg">.</span>_has_events<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/opt/local/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/sqlalchemy/engine/base.py</span> in <span class="ansi-cyan-fg">_execute_context</span><span class="ansi-blue-fg">(self, dialect, constructor, statement, parameters, *args)</span>
<span class="ansi-green-intense-fg ansi-bold">   1248</span>         <span class="ansi-green-fg">except</span> BaseException <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1249</span>             self._handle_dbapi_exception(
<span class="ansi-green-fg">-&gt; 1250</span><span class="ansi-red-fg">                 </span>e<span class="ansi-blue-fg">,</span> statement<span class="ansi-blue-fg">,</span> parameters<span class="ansi-blue-fg">,</span> cursor<span class="ansi-blue-fg">,</span> context
<span class="ansi-green-intense-fg ansi-bold">   1251</span>             )
<span class="ansi-green-intense-fg ansi-bold">   1252</span> 

<span class="ansi-green-fg">/opt/local/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/sqlalchemy/engine/base.py</span> in <span class="ansi-cyan-fg">_handle_dbapi_exception</span><span class="ansi-blue-fg">(self, e, statement, parameters, cursor, context)</span>
<span class="ansi-green-intense-fg ansi-bold">   1474</span>                 util<span class="ansi-blue-fg">.</span>raise_from_cause<span class="ansi-blue-fg">(</span>newraise<span class="ansi-blue-fg">,</span> exc_info<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1475</span>             <span class="ansi-green-fg">elif</span> should_wrap<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1476</span><span class="ansi-red-fg">                 </span>util<span class="ansi-blue-fg">.</span>raise_from_cause<span class="ansi-blue-fg">(</span>sqlalchemy_exception<span class="ansi-blue-fg">,</span> exc_info<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1477</span>             <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1478</span>                 util<span class="ansi-blue-fg">.</span>reraise<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>exc_info<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/local/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/sqlalchemy/util/compat.py</span> in <span class="ansi-cyan-fg">raise_from_cause</span><span class="ansi-blue-fg">(exception, exc_info)</span>
<span class="ansi-green-intense-fg ansi-bold">    396</span>     exc_type<span class="ansi-blue-fg">,</span> exc_value<span class="ansi-blue-fg">,</span> exc_tb <span class="ansi-blue-fg">=</span> exc_info
<span class="ansi-green-intense-fg ansi-bold">    397</span>     cause <span class="ansi-blue-fg">=</span> exc_value <span class="ansi-green-fg">if</span> exc_value <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> exception <span class="ansi-green-fg">else</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-fg">--&gt; 398</span><span class="ansi-red-fg">     </span>reraise<span class="ansi-blue-fg">(</span>type<span class="ansi-blue-fg">(</span>exception<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> exception<span class="ansi-blue-fg">,</span> tb<span class="ansi-blue-fg">=</span>exc_tb<span class="ansi-blue-fg">,</span> cause<span class="ansi-blue-fg">=</span>cause<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    399</span> 
<span class="ansi-green-intense-fg ansi-bold">    400</span> 

<span class="ansi-green-fg">/opt/local/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/sqlalchemy/util/compat.py</span> in <span class="ansi-cyan-fg">reraise</span><span class="ansi-blue-fg">(tp, value, tb, cause)</span>
<span class="ansi-green-intense-fg ansi-bold">    150</span>             value<span class="ansi-blue-fg">.</span>__cause__ <span class="ansi-blue-fg">=</span> cause
<span class="ansi-green-intense-fg ansi-bold">    151</span>         <span class="ansi-green-fg">if</span> value<span class="ansi-blue-fg">.</span>__traceback__ <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> tb<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 152</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">raise</span> value<span class="ansi-blue-fg">.</span>with_traceback<span class="ansi-blue-fg">(</span>tb<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    153</span>         <span class="ansi-green-fg">raise</span> value
<span class="ansi-green-intense-fg ansi-bold">    154</span> 

<span class="ansi-green-fg">/opt/local/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/sqlalchemy/engine/base.py</span> in <span class="ansi-cyan-fg">_execute_context</span><span class="ansi-blue-fg">(self, dialect, constructor, statement, parameters, *args)</span>
<span class="ansi-green-intense-fg ansi-bold">   1244</span>                 <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> evt_handled<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1245</span>                     self.dialect.do_execute(
<span class="ansi-green-fg">-&gt; 1246</span><span class="ansi-red-fg">                         </span>cursor<span class="ansi-blue-fg">,</span> statement<span class="ansi-blue-fg">,</span> parameters<span class="ansi-blue-fg">,</span> context
<span class="ansi-green-intense-fg ansi-bold">   1247</span>                     )
<span class="ansi-green-intense-fg ansi-bold">   1248</span>         <span class="ansi-green-fg">except</span> BaseException <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/opt/local/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/sqlalchemy/engine/default.py</span> in <span class="ansi-cyan-fg">do_execute</span><span class="ansi-blue-fg">(self, cursor, statement, parameters, context)</span>
<span class="ansi-green-intense-fg ansi-bold">    586</span> 
<span class="ansi-green-intense-fg ansi-bold">    587</span>     <span class="ansi-green-fg">def</span> do_execute<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> cursor<span class="ansi-blue-fg">,</span> statement<span class="ansi-blue-fg">,</span> parameters<span class="ansi-blue-fg">,</span> context<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 588</span><span class="ansi-red-fg">         </span>cursor<span class="ansi-blue-fg">.</span>execute<span class="ansi-blue-fg">(</span>statement<span class="ansi-blue-fg">,</span> parameters<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    589</span> 
<span class="ansi-green-intense-fg ansi-bold">    590</span>     <span class="ansi-green-fg">def</span> do_execute_no_params<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> cursor<span class="ansi-blue-fg">,</span> statement<span class="ansi-blue-fg">,</span> context<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">OperationalError</span>: (sqlite3.OperationalError) database is locked
[SQL: 
    CREATE TABLE phonebook (
      id INT PRIMARY KEY,
      name VARCHAR,
      phone_number VARCHAR
    ) 
]
(Background on this error at: http://sqlalche.me/e/e3q8)</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>INSERT</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>UPDATE</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>DELETE</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Závěr</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Odkazy</h2>
<p><a href="https://naucse.python.cz/2019/brno-podzim-2019-ut/beginners/database/">https://naucse.python.cz/2019/brno-podzim-2019-ut/beginners/database/</a></p>
</div>
</div>
</div>
 

